DROP DATABASE IF EXISTS Kmetijski_Izdelki;

CREATE DATABASE Kmetijski_Izdelki;

ALTER DATABASE Kmetijski_Izdelki CHARACTER 
SET utf8mb4 COLLATE utf8mb4_general_ci;

USE Kmetijski_Izdelki;

CREATE TABLE Uporabnik(
	Uporabnisko_ime VARCHAR(50) PRIMARY KEY,
	Ime VARCHAR(50) NOT NULL,
	Priimek VARCHAR(50) NOT NULL,
	Geslo VARCHAR(512) NOT NULL,
	TokenWeb VARCHAR(64),
	TokenAndroid VARCHAR(64),
	Pravila VARCHAR(9) NOT NULL DEFAULT 'Uporabnik' CHECK(Pravila IN('Admin', 'Uporabnik'))
	);

CREATE TABLE Stranka(
	id_stranke INT PRIMARY KEY AUTO_INCREMENT,
	Ime VARCHAR(50) NOT NULL,
	Priimek VARCHAR(50) NOT NULL
);

CREATE TABLE Izdelek(
	Izdelek VARCHAR(50) PRIMARY KEY,
	Merska_enota VARCHAR(10) CHECK(Merska_enota IN('', 'L', 'm3', 'dm3', 'cm3', 't', 'kg', 'dag', 'g', 'kos', 'enot', 'par', 'kpl'))
);

CREATE TABLE Prodaja(
	id_prodaje INT PRIMARY KEY AUTO_INCREMENT,
	Datum_Prodaje DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
	Datum_Vpisa DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
	Koliko INT NOT NULL,
	id_stranke INT NOT NULL,
	Uporabnisko_ime VARCHAR(50) NOT NULL,
	Izdelek VARCHAR(50) NOT NULL,
	FOREIGN KEY (id_stranke) REFERENCES Stranka(id_stranke), 
	FOREIGN KEY (Uporabnisko_ime) REFERENCES Uporabnik(Uporabnisko_ime), 
	FOREIGN KEY (Izdelek) REFERENCES Izdelek(Izdelek)
);

CREATE TABLE Nacrtovani_Prevzemi(
	id_nacrtovani_prevzem INT PRIMARY KEY AUTO_INCREMENT,
	Kolicina INT NOT NULL,
	Dan VARCHAR(40) NOT NULL CHECK(Dan IN('Ponedeljek', 'Torek', 'Sreda', 'Četrtek', 'Petek', 'Sobota', 'Nedelja')),
	Cas VARCHAR(40) DEFAULT 'Cel' CHECK(Cas IN('Zjutraj', 'Zvečer', 'Sredi', 'Cel')),
	Izdelek VARCHAR(50) NOT NULL,
	id_stranke INT NOT NULL,
	Cas_Enkrat DATETIME,
	FOREIGN KEY (id_stranke) REFERENCES Stranka(id_stranke), 
	FOREIGN KEY (Izdelek) REFERENCES Izdelek(Izdelek)
);

